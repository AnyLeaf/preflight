<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Preflight</title>

    <link rel="stylesheet" href="style.css">
</head>
<body>

<div style="display: flex; flex-direction: column; align-items: center">
    <h1>AnyLeaf Preflight</h1>

    <h2>Attitude</h2>
    <p>Verify that the orientation of your quadcoper depicted below is correct. Rotate it
        in various directions, and confirm that the rendering moves as expected.</p>

    <div id="attitude-render">
        <!--    <div class="attitude-layout">-->
        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Pitch</h3>-->
        <!--            <h3 id="pitch-reading"></h3>-->
        <!--        </div>-->


        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Roll</h3>-->
        <!--            <h3 id="roll-reading"></h3>-->
        <!--        </div>-->


        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Yaw</h3>-->
        <!--            <h3 id="yaw-reading"></h3>-->
        <!--        </div>-->

        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Pitch</h3>-->
        <!--            <h3 id="pitch-rate-reading"></h3>-->
        <!--        </div>-->


        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Roll</h3>-->
        <!--            <h3 id="roll-rate-reading"></h3>-->
        <!--        </div>-->


        <!--        <div style="display: flex;">-->
        <!--            <h3 style="margin-right: 10px;">Yaw</h3>-->
        <!--            <h3 id="yaw-rate-reading"></h3>-->
        <!--        </div>-->

    </div>

    <h2>Altimeter (barometric)</h2>
    <div style="display:flex;">
        <h3 style="margin-right: 10px;">Altitude, in meters MSL. Altitude in use will show relative to launch altitude.</h3>
        <h3 id="altimeter-reading"></h3>
    </div>

    <h2>Altimeter (Time-of-flight)</h2>
    <div style="display:flex;">
        <h3 style="margin-right: 10px;">Altitude, in meters AGL.</h3>
        <h3 id="altimeter-agl-reading"></h3>
    </div>

<!--    <div style="display:flex;">-->
<!--        <h3 style="margin-right: 10px;">Launch location elevation, meters MSL</h3>-->
<!--        <input id="launch-elevation" type="number" value="110" />-->
<!--    </div>-->

    <h2 style="margin-top: 40px; margin-bottom: 10px;">Power system</h2>
    <div style="display: flex; border: 1px solid #666666; padding: 20px;">
        <div style="display: flex; flex-direction: column; justify-content: center;">
            <h3 style="margin-right: 10px;">Battery voltage</h3>
            <h3 id="voltage-reading"></h3>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 60px;">
            <h3 style="margin-right: 10px;">ESC current</h3>
            <h3 id="current-reading"></h3>
        </div>
    </div>

    <h2 style="margin-top: 40px; margin-bottom: 10px;">Controls</h2>
    <!--        <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr 1fr; grid-gap: 60px;">-->
    <div style="display: flex; align-items: center; justify-content: center; border: 1px solid #666666; padding: 20px;">
        <!--            <div style="display: flex; justify-content: center; grid-row: 1/2; grid-column: 1/2;">-->
        <div style="display: flex; flex-direction: column; justify-content: center;">
            <h3 style="margin-right: 10px;">Roll</h3>
            <h3 id="control-roll-reading"></h3>
        </div>

        <!--            <div style="display: flex; grid-row: 1/2; grid-column: 2/3;">-->
        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 60px;">
            <h3 style="margin-right: 10px;">Pitch</h3>
            <h3 id="control-pitch-reading"></h3>
        </div>

        <!--            <div style="display: flex; grid-row: 2/3; grid-column: 1/2;">-->
        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 60px;">
            <h3 style="margin-right: 10px;">Yaw</h3>
            <h3 id="control-yaw-reading"></h3>
        </div>

        <!--            <div style="display: flex; grid-row: 2/3; grid-column: 2/3;">-->
        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 60px;">
            <h3 style="margin-right: 10px;">Throttle</h3>
            <h3 id="control-throttle-reading"></h3>
        </div>
    </div>

    <div style="display: flex; align-items: center; justify-content: center;">
        <div style="display: flex; grid-row: 3/4; grid-column: 1/2;">
            <h3 style="margin-right: 10px;">Arm switch</h3>
            <h3 id="control-arm-reading"></h3>
        </div>

        <div style="display: flex; grid-row: 3/4; grid-column: 2/3;">
            <h3 style="margin-right: 10px;">Mode control</h3>
            <h3 id="control-mode-reading"></h3>
        </div>
    </div>

    <h2 style="margin-top: 40px; margin-bottom: 10px;">Control link quality</h2>
    <div style="display: flex; border: 1px solid #666666; padding: 20px;">
        <div style="display: flex; flex-direction: column; justify-content: center;">
            <h3 style="margin-right: 10px;">RSSI 1</h3>
            <h3 id="rssi-1-reading"></h3>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 40px;">
            <h3 style="margin-right: 10px;">RSSI 2</h3>
            <h3 id="rssi-2-reading"></h3>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 40px;">
            <!--                Percentage of packets succesfully received over last 100. -->
            <h3 style="margin-right: 10px;">Link quality</h3>
            <h3 id="link-quality-reading"></h3>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 40px;">
            <h3 style="margin-right: 10px;">Signal-to-noise ratio</h3>
            <h3 id="snr-reading"></h3>
        </div>

        <div style="display: flex; flex-direction: column; justify-content: center; margin-left: 40px;">
            <h3 style="margin-right: 10px;">Tx power (mW)</h3>
            <h3 id="tx-power-reading"></h3>
        </div>
    </div>


    <h2 style="margin-top: 100px;">Motor arrangement, spin direction, and testing</h2>

    <button
            style="background-color: #e18888;
"
            onclick="armMotors()"
    >
        ⚠️Enable motors. Don't do this if props are attached!⚠️
    </button>

    <!--    ↺-->

    <div style="display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; grid-gap: 60px;">

        <div style="display: flex; flex-direction: column; grid-column: 1 / 2; grid-row: 1 / 2;">
            <h2>Front-left</h2>
            <button>Direction: <span>Normal ↻↺</span></button>
            <!--            todo: Grey out/disable or something if not armed-->
            <button onclick="startMotor('front-left')">Stopped (Click to start)</button>
        </div>

        <div style="display: flex; flex-direction: column; grid-column: 2 / 3; grid-row: 1 / 2;">
            <h2>Front-right</h2>
            <button>Direction: <span>Normal ↻↺</span></button>
            <button onclick="startMotor('front-right')">Stopped (Click to start)</button>
        </div>

        <div style="display: flex; flex-direction: column; grid-column: 1 / 2; grid-row: 2 / 3;">
            <h2>Aft-left</h2>
            <button>Direction: <span>Normal ↻↺</span></button>
            <button onclick="startMotor('aft-left')">Stopped (Click to start)</button>
        </div>

        <div style="display: flex; flex-direction: column; grid-column: 2 / 3; grid-row: 2 / 3;">
            <h2>Aft-right</h2>
            <button>Direction: <span>Normal ↻↺</span></button>
            <button onclick="startMotor('aft-right')">Stopped (Click to start)</button>
        </div>

    </div>

    <h2 style="margin-top: 100px;">Servo mapping, range, and testing</h2>

    <div style="display: flex">
        <h4>Set left elevon position</h4>
        <input type="number" value="0."/>
        <h4>Set right elevon position</h4>
        <input type="number" value="0."/>
        <button>Swap left elevon direction</button>
        <button>Swap right elevon direction</button>
    </div>

<!--    todo: Consider placing steerpoints on a sep page, or hidden with a button-->
        <h2 style="margin-top: 40px; margin-bottom: 10px;">Waypoints</h2>
    <div id="waypoints" style="display: flex; border: 1px solid #666666; padding: 20px;"></div>

</div>

</body>
</html>

<script src="three.min.js"></script>
<script src="code.js"></script>

<script>
    UPDATE_RATE = 2.; // Hz.

    window.onload = function() {
        // The calls we make on the frontend don't directly trigger a reading pull
        // from the FC; they get the latest the server has cached.
        setInterval(update_readings, 1_000. / UPDATE_RATE)
    }
</script>